<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Unity Web Player | Jubilo Games</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico" />
    <link rel="stylesheet" href="TemplateData/style.css" />

    <!-- ‚úÖ EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <style>
  html, body {
    margin: 0;
    padding: 0;
    background-color: #ffffff;
    height: 100%;
    width: 100%;
    overflow: hidden;
  }

  #unity-container {
    width: 100vw;
    height: 100vh;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  canvas {
    aspect-ratio: 16 / 9;
    width: 100%;
    max-height: 100%;
    max-width: 100%;
  }

  #unity-loading-bar {
    position: absolute;
    top: 10px;
    width: 100%;
  }
</style>


    <script>
      let unityInstance = null;
      const emailToSend = "jubilo.gamestudio@gmail.com"; // ‚úÖ Your hardcoded email

      window.emailjsReady = false;

      window.addEventListener("DOMContentLoaded", function () {
        if (typeof emailjs !== "undefined") {
          emailjs.init("JCfEnadXLBXD3_Ds8"); // ‚úÖ Your EmailJS public key
          window.emailjsReady = true;
          console.log("‚úÖ EmailJS initialized");
        } else {
          console.error("‚ùå EmailJS failed to load.");
        }
      });

      function onUnityLoaded(instance) {
        unityInstance = instance;
        console.log("‚úÖ Unity instance loaded");

        if (emailToSend && unityInstance) {
          unityInstance.SendMessage("EndGameMenu", "SetEmailTarget", emailToSend);
          console.log("üì® Email sent to Unity:", emailToSend);
        }
      }

      function SendEmailViaJS(recipientPtr, messagePtr, namePtr, scorePtr, imageBase64Ptr) {
        if (!window.emailjsReady || typeof emailjs === "undefined") {
          console.error("‚ùå EmailJS not ready.");
          return;
        }

        const recipient = UTF8ToString(recipientPtr);
        const message = UTF8ToString(messagePtr);
        const name = UTF8ToString(namePtr);
        const score = UTF8ToString(scorePtr);
        const base64 = UTF8ToString(imageBase64Ptr);

        fetch("https://api.imgur.com/3/image", {
          method: "POST",
          headers: {
            Authorization: "Client-ID cb5e2bb920d6bf7", // ‚úÖ Replace with your Imgur client ID
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ image: base64, type: "base64" }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (!data.success) throw new Error("Imgur upload failed");
            const imageUrl = data.data.link;

            return emailjs.send(
              "service_0x00k3y",
              "template_ph5qn3g",
              {
                email: recipient,
                name: name,
                score: score,
                message: message,
                image_url: imageUrl,
              },
              "JCfEnadXLBXD3_Ds8"
            );
          })
          .then((res) => {
            console.log("‚úÖ Email sent:", res.status);
            unityInstance.SendMessage("EndGameMenu", "NotifyUser", "Email sent successfully!");
          })
          .catch((err) => {
            console.error("‚ùå Email error:", err);
            unityInstance.SendMessage("EndGameMenu", "NotifyUser", "Failed to send email.");
          });
      }

      mergeInto(LibraryManager.library, {
        SendEmailViaJS,
      });
    </script>
  </head>
  <body>
    <div id="unity-container">
      <canvas id="unity-canvas" tabindex="-1"></canvas>
      <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty">
          <div id="unity-progress-bar-full"></div>
        </div>
      </div>
      <div id="unity-warning"></div>
      <div id="unity-footer">
        <div id="unity-logo-title-footer"></div>
        <div id="unity-fullscreen-button"></div>
        <div id="unity-build-title">Jubilo Games</div>
      </div>
    </div>

    <script>
      const canvas = document.querySelector("#unity-canvas");

      function unityShowBanner(msg, type) {
        const warningBanner = document.querySelector("#unity-warning");
        const div = document.createElement("div");
        div.innerHTML = msg;
        warningBanner.appendChild(div);
        warningBanner.style.display = "block";
        if (type === "error") div.style = "background: red; padding: 10px;";
        else {
          div.style = "background: yellow; padding: 10px;";
          setTimeout(() => {
            warningBanner.removeChild(div);
            warningBanner.style.display = warningBanner.children.length ? "block" : "none";
          }, 5000);
        }
      }

      const buildUrl = "Build";
      const loaderUrl = buildUrl + "/Jubilo_idanMaor_Wedding.loader.js";
      const config = {
        dataUrl: buildUrl + "/Jubilo_idanMaor_Wedding.data",
        frameworkUrl: buildUrl + "/Jubilo_idanMaor_Wedding.framework.js",
        codeUrl: buildUrl + "/Jubilo_idanMaor_Wedding.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "Jubilo Games",
        productName: "Jubilo Games",
        productVersion: "1.0",
        showBanner: unityShowBanner,
      };

      document.querySelector("#unity-loading-bar").style.display = "block";

      const script = document.createElement("script");
      script.src = loaderUrl;
      script.onload = () => {
        createUnityInstance(canvas, config, (progress) => {
          document.querySelector("#unity-progress-bar-full").style.width = 100 * progress + "%";
        })
          .then((instance) => {
            onUnityLoaded(instance);
            document.querySelector("#unity-loading-bar").style.display = "none";
            document.querySelector("#unity-fullscreen-button").onclick = () => {
              unityInstance.SetFullscreen(1);
            };
          })
          .catch((message) => {
            alert(message);
          });
      };
      document.body.appendChild(script);
    </script>
  </body>
</html>
